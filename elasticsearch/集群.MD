### [集群](https://www.elastic.co/guide/en/elasticsearch/reference/current/add-elasticsearch-nodes.html)

当你正在运行Elasticsearch的单个实例，则你拥有一个节点的集群。所有主分片都驻留在单个节点上。不能分配副本分片，因此群集状态保持黄色。群集功能齐全，但在发生故障时存在数据丢失的风险。

> 检查集群健康状况  GET /_cat/health

![单节点](../img/cluster1.png)

一个节点即是数据节点又可以被选中当成主节点来控制其他节点，[主节点选择机制详见官网](https://www.elastic.co/guide/en/elasticsearch/reference/current/modules-discovery.html)



#### 扩容

1. 通过reindex把当前的index中的数据重新索引到一个更多分片的索引上，但是这个时间是不能估算出来的。

2. 由于集群索引的主分片数量是一开始创建好，并且固定的，那么我们可以预先多设置一些主分片。以后加机器。但是我们来考虑一下

```text
我不知道这个索引将来会变得多大，并且过后我也不能更改索引的大小，所以为了保险起见，还是给它设为 1000 个分片吧…
    
                                                                                        -- 一个新手的话

```
在你扩充足够的节点之前需要再三考虑你的数据模型，每个分片都是有代价的

 * 一个分片的底层即为一个 Lucene 索引，会消耗一定文件句柄、内存、以及 CPU 运转。
 
 * 每一个搜索请求都需要命中索引中的每一个分片，如果每一个分片都处于不同的节点还好， 但如果多个分片都需要在同一个节点上竞争使用相同的资源就有些糟糕了。
 
 * 用于计算相关度的词项统计信息是基于分片的。如果有许多分片，每一个都只有很少的数据会导致很低的相关度。
 
 适当的预分配是好的
 
 3. 通过副分片来进行横向扩容和负载均衡
 
 ![负载均衡](../img/balance.png)
 
 节点3虽然没有主分片，然而没有主分片并不重要。副本分片与主分片做着相同的工作；它们只是扮演着略微不同的角色。没有必要确保主分片均匀地分布在所有节点中。
 
 4. 没有任何规则限制你的应用程序只使用一个索引。 当我们发起一个搜索请求时，它被转发至索引中每个分片的一份拷贝（一个主分片或一个副本分片），如果我们向多个索引发出同样的请求，会发生完全相同的事情——只不过会涉及更多的分片。
 
 以上4点只是一些思路，待实践中摸索。